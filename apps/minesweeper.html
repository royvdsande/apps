
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minesweeper</title>

  <script>
    (function() {
      try {
        var pref = localStorage.getItem('theme-preference') || 'system';
        var root = document.documentElement;
        if (pref === 'light') {
          root.setAttribute('data-theme','light');
        } else if (pref === 'dark') {
          root.setAttribute('data-theme','dark');
        } else {
          root.removeAttribute('data-theme');
        }
      } catch(e) { /* noop */ }
    })();
  </script>

  <link rel="stylesheet" href="../styles.css" />

  <style>
    :root{
      --cell-size: 34px;
      --gap: 4px;
      --ms-cell: #d0d6e2;
      --ms-cell-border: #b7bfce;
      --ms-cell-revealed: #f0f3f9;
      --ms-cell-revealed-border: #cdd5e3;
      --ms-cell-shadow: inset 0 2px 0 rgba(255,255,255,.35), inset 0 -2px 0 rgba(0,0,0,.04);
      --ms-mine-bg: #ffd9dd;
      --ms-hover: rgba(63,81,181,0.15);
      --header-height: 72px;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --ms-cell: #1f2937;
        --ms-cell-border: #111827;
        --ms-cell-revealed: #131c23;
        --ms-cell-revealed-border: #223042;
        --ms-cell-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.6);
        --ms-mine-bg: rgba(248,113,113,0.22);
        --ms-hover: rgba(144,202,249,0.2);
      }
    }

    :root[data-theme="dark"]{
      --ms-cell: #1f2937;
      --ms-cell-border: #111827;
      --ms-cell-revealed: #131c23;
      --ms-cell-revealed-border: #223042;
      --ms-cell-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.6);
      --ms-mine-bg: rgba(248,113,113,0.22);
      --ms-hover: rgba(144,202,249,0.2);
    }

    :root[data-theme="light"]{
      --ms-cell: #d0d6e2;
      --ms-cell-border: #b7bfce;
      --ms-cell-revealed: #f0f3f9;
      --ms-cell-revealed-border: #cdd5e3;
      --ms-cell-shadow: inset 0 2px 0 rgba(255,255,255,.35), inset 0 -2px 0 rgba(0,0,0,.04);
      --ms-mine-bg: #ffd9dd;
      --ms-hover: rgba(63,81,181,0.15);
    }

    *{box-sizing:border-box}
    html, body{height:100%; overflow:hidden;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-gradient);
      color: var(--text);
      min-height:100dvh;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    main{
      flex:1;
      min-height:0;
      height:calc(100dvh - var(--header-height));
      max-height:calc(100dvh - var(--header-height));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:clamp(12px, 3vh, 24px);
      overflow:hidden;
    }
    .app{
      width:min(100%, 900px);
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height:100%;
      overflow:hidden;
    }
    .app-header{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      padding: 8px 8px 4px;
    }
    .left, .right{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .stat{
      background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:8px 10px; min-width:90px;
      display:flex; align-items:center; gap:8px; box-shadow: var(--shadow);
    }
    .stat b{font-variant-numeric: tabular-nums}
    select, input[type=number]{
      border:1px solid var(--border); border-radius:8px; padding:8px 10px; background:var(--panel); color:var(--text);
    }
    .app button{
      border:1px solid var(--border); background:var(--panel); color:var(--text); border-radius:10px; padding:8px 12px; cursor:pointer; box-shadow: var(--shadow);
    }
    .app button:hover{filter:brightness(0.98)}
    .app button:active{transform: translateY(1px)}

    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .group{display:flex; gap:6px; align-items:center}
    .hidden{display:none}

    .board-wrap{
      margin-top:12px; padding:12px; border:1px solid var(--border); border-radius:14px; background:var(--panel); box-shadow: var(--shadow);
      display:flex; align-items:center; justify-content:center;
      flex:1; min-height:0; overflow:hidden;
    }
    #board{
      display:grid; grid-template-columns: repeat(10, var(--cell-size)); grid-auto-rows: var(--cell-size);
      gap: var(--gap);
      justify-content:center;
      touch-action: manipulation;
      user-select: none;
    }
    .cell{
      width:var(--cell-size); height:var(--cell-size); border-radius:8px; background:var(--ms-cell); border:1px solid var(--ms-cell-border);
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; color:var(--text);
      box-shadow: var(--ms-cell-shadow);
      position:relative;
    }
    .cell:hover{filter:brightness(1.02)}
    .cell.revealed{
      background:var(--ms-cell-revealed); border-color:var(--ms-cell-revealed-border); box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
    }
    .cell.mine.revealed{ background:var(--ms-mine-bg); }
    .cell.blast{ animation: blip .18s ease-out 2 alternate; }
    @keyframes blip{from{transform:scale(1)} to{transform:scale(1.08)}}

    .cell.flag::after{ content:"üö©"; }
    .cell.mine.revealed::after{ content:"üí£"; }

    /* Kleuren voor cijfers 1-8 */
    .n1{ color:#1976d2 }
    .n2{ color:#388e3c }
    .n3{ color:#d32f2f }
    .n4{ color:#7b1fa2 }
    .n5{ color:#bf360c }
    .n6{ color:#00838f }
    .n7{ color:#424242 }
    .n8{ color:#222 }

    .footer{ margin-top:auto; text-align:center; color:var(--muted); font-size:12px }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand" aria-label="Rvds" title="Rvds">Rvds</div>
    <nav class="site-nav">
      <a href="../index.html#apps">Apps</a>

      <div class="theme-switch" role="group" aria-label="Thema">
        <button class="theme-btn" data-theme="system" title="Systeem" aria-pressed="true">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v9H3V5Zm-2 11h22v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1Z"/></svg>
          <span class="visually-hidden">Systeem</span>
        </button>
        <button class="theme-btn" data-theme="light" title="Licht" aria-pressed="false">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M12 4a1 1 0 0 0 1-1V1h-2v2a1 1 0 0 0 1 1Zm0 16a1 1 0 0 0-1 1v2h2v-2a1 1 0 0 0-1-1ZM4 11H1v2h3v-2Zm22 0h-3v2h3v-2ZM5.64 6.05 3.52 3.93l-1.41 1.41 2.12 2.12 1.41-1.41Zm15.25 15.25-2.12-2.12-1.41 1.41 2.12 2.12 1.41-1.41ZM18.36 6.05l1.41-1.41L17.66 2.1l-1.41 1.41 2.11 2.54Zm-12.02 12.9-1.41 1.41 2.12 2.12 1.41-1.41-2.12-2.12ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z"/></svg>
          <span class="visually-hidden">Licht</span>
        </button>
        <button class="theme-btn" data-theme="dark" title="Donker" aria-pressed="false">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/></svg>
          <span class="visually-hidden">Donker</span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <div class="app" role="application" aria-label="Minesweeper">
      <div class="app-header">
        <div class="left">
          <div class="stat" aria-live="polite" title="Aantal niet-geflagde mijnen">
            ‚õ≥ <span>Mijnen:</span> <b id="mineCount">0</b>
          </div>
          <div class="stat" aria-live="polite" title="Verstreken tijd in seconden">
            ‚è±Ô∏è <span>Tijd:</span> <b id="timer">0</b>s
          </div>
          <button id="resetBtn" title="Nieuw spel">üôÇ</button>
        </div>
        <div class="right">
          <div class="toolbar">
            <div class="group">
              <label for="difficulty">Moeilijkheid:</label>
              <select id="difficulty">
                <option value="beginner">Beginner (9√ó9, 10)</option>
                <option value="gevorderd">Gevorderd (16√ó16, 40)</option>
                <option value="expert">Expert (16√ó30, 99)</option>
                <option value="custom">Aangepast</option>
              </select>
            </div>
            <div id="customPane" class="group hidden">
              <label>Rijen <input id="rows" type="number" min="5" max="40" value="16" /></label>
              <label>Kolommen <input id="cols" type="number" min="5" max="40" value="16" /></label>
              <label>Mijnen <input id="mines" type="number" min="1" value="40" /></label>
              <button id="applyCustom">Toepassen</button>
            </div>
            <button id="flagModeBtn" type="button" title="Schakel vlag-modus (voor mobiel)" aria-pressed="false">üö© Vlag-modus: UIT</button>
          </div>
        </div>
      </div>

      <div class="board-wrap">
        <div id="board"></div>
      </div>

      <div class="footer">Tip: Klik met rechts om te vlaggen. Op mobiel: lang indrukken of gebruik de knop <em>Vlag-modus</em>.</div>
    </div>
  </main>

  <script src="../assets/js/theme.js" defer></script>

<script>
// --- Minesweeper (Nederlands) -------------------------------------------------
// Functies en UI in √©√©n HTML-bestand, geen afhankelijkheden.

(function(){
  'use strict';

  const numberClasses = ['n1','n2','n3','n4','n5','n6','n7','n8'];

  let rows = 9;
  let cols = 9;
  let mineSetting = 10;
  let totalMines = mineSetting;
  let firstClick = true;
  let board = [];
  let remainingMines = mineSetting;
  let revealedCount = 0;
  let flaggedCount = 0;
  let timerId = null;
  let seconds = 0;
  let gameOver = false;
  let flagMode = false;

  const elBoard = document.getElementById('board');
  const elMineCount = document.getElementById('mineCount');
  const elTimer = document.getElementById('timer');
  const elReset = document.getElementById('resetBtn');
  const elDiff = document.getElementById('difficulty');
  const elCustomPane = document.getElementById('customPane');
  const elRows = document.getElementById('rows');
  const elCols = document.getElementById('cols');
  const elMines = document.getElementById('mines');
  const elApplyCustom = document.getElementById('applyCustom');
  const elFlagMode = document.getElementById('flagModeBtn');
  const rootEl = document.documentElement;
  const headerEl = document.querySelector('.site-header');
  const mainEl = document.querySelector('main');
  const boardWrap = document.querySelector('.board-wrap');
  const footerEl = document.querySelector('.footer');

  function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

  function syncViewportMetrics() {
    if (headerEl) {
      rootEl.style.setProperty('--header-height', `${headerEl.offsetHeight}px`);
    }
  }

  syncViewportMetrics();

  if ('ResizeObserver' in window && headerEl) {
    const headerObserver = new ResizeObserver(syncViewportMetrics);
    headerObserver.observe(headerEl);
  }
  function idxIn(r, c) { return r >= 0 && r < rows && c >= 0 && c < cols; }
  function neighbors(r, c) {
    const ns = [];
    for (let dr = -1; dr <= 1; dr++) {
      for (let dc = -1; dc <= 1; dc++) {
        if (dr === 0 && dc === 0) continue;
        const rr = r + dr;
        const cc = c + dc;
        if (idxIn(rr, cc)) ns.push([rr, cc]);
      }
    }
    return ns;
  }

  function maxAllowedMines(r, c) {
    const total = r * c;
    const reserved = Math.min(total, 9);
    return Math.max(1, total - reserved);
  }

  function stopTimer() {
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  function startTimer() {
    if (!timerId) {
      timerId = setInterval(() => {
        seconds++;
        elTimer.textContent = String(seconds);
      }, 1000);
    }
  }

  function resetTimer() {
    stopTimer();
    seconds = 0;
    elTimer.textContent = '0';
  }

  function updateMineCount() {
    elMineCount.textContent = String(Math.max(0, remainingMines));
  }

  function setFace(face) {
    elReset.textContent = face;
  }

  function updateFlagButtonState() {
    elFlagMode.textContent = flagMode ? 'üö© Vlag-modus: AAN' : 'üö© Vlag-modus: UIT';
    elFlagMode.setAttribute('aria-pressed', flagMode ? 'true' : 'false');
  }

  function createEmptyBoard() {
    board = Array.from({ length: rows }, () =>
      Array.from({ length: cols }, () => ({
        mine: false,
        revealed: false,
        flagged: false,
        adjacent: 0
      }))
    );
  }

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = (Math.random() * (i + 1)) | 0;
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function placeMines(excludeSet) {
    const cells = [];
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const key = r + ',' + c;
        if (!excludeSet.has(key)) cells.push([r, c]);
      }
    }
    shuffle(cells);
    const available = cells.length;
    const target = Math.min(mineSetting, available);
    totalMines = target;
    mineSetting = target;
    flaggedCount = 0;
    remainingMines = totalMines;
    updateMineCount();

    for (let i = 0; i < target; i++) {
      const [r, c] = cells[i];
      board[r][c].mine = true;
    }

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        if (board[r][c].mine) {
          board[r][c].adjacent = 0;
          continue;
        }
        let count = 0;
        for (const [rr, cc] of neighbors(r, c)) {
          if (board[rr][cc].mine) count++;
        }
        board[r][c].adjacent = count;
      }
    }
  }

  function updateCellSizing() {
    if (!boardWrap) return;
    const wrapStyles = getComputedStyle(boardWrap);
    const padX = (parseFloat(wrapStyles.paddingLeft) || 0) + (parseFloat(wrapStyles.paddingRight) || 0);
    const padY = (parseFloat(wrapStyles.paddingTop) || 0) + (parseFloat(wrapStyles.paddingBottom) || 0);
    const availableWidth = Math.max(200, boardWrap.clientWidth - padX);
    const rect = boardWrap.getBoundingClientRect();
    const mainStyles = mainEl ? getComputedStyle(mainEl) : null;
    const mainBottom = mainStyles ? (parseFloat(mainStyles.paddingBottom) || 0) : 0;
    const footerHeight = footerEl ? footerEl.offsetHeight + (parseFloat(getComputedStyle(footerEl).marginTop) || 0) : 0;
    const reserved = Math.max(16, mainBottom + footerHeight + 12);
    const availableHeight = Math.max(200, window.innerHeight - rect.top - reserved - padY);
    let size = Math.floor(Math.min(availableWidth / cols, availableHeight / rows));
    size = clamp(size, 20, 48);
    const gap = clamp(Math.round(size * 0.12), 2, Math.round(size * 0.2));
    document.documentElement.style.setProperty('--cell-size', `${size}px`);
    document.documentElement.style.setProperty('--gap', `${gap}px`);
  }

  function drawBoard() {
    elBoard.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
    elBoard.innerHTML = '';
    const frag = document.createDocumentFragment();

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'cell';
        btn.dataset.r = String(r);
        btn.dataset.c = String(c);
        btn.setAttribute('aria-label', `Vakje ${r + 1},${c + 1}`);
        btn.oncontextmenu = (e) => { e.preventDefault(); toggleFlag(r, c); };
        btn.addEventListener('mousedown', () => { if (!gameOver) setFace('üòÆ'); });
        btn.addEventListener('mouseup', () => { if (!gameOver) setFace('üôÇ'); });

        btn.addEventListener('click', (e) => {
          e.preventDefault();
          if (flagMode) {
            toggleFlag(r, c);
          } else {
            reveal(r, c);
          }
        });

        btn.addEventListener('auxclick', (e) => {
          if (e.button === 1) chord(r, c);
        });

        let touchTimer = null;
        let moved = false;

        btn.addEventListener('touchstart', () => {
          moved = false;
          if (!gameOver) setFace('üòÆ');
          touchTimer = setTimeout(() => {
            toggleFlag(r, c);
            touchTimer = null;
          }, 450);
        }, { passive: true });

        btn.addEventListener('touchmove', () => {
          moved = true;
          if (touchTimer) {
            clearTimeout(touchTimer);
            touchTimer = null;
          }
        }, { passive: true });

        const touchCleanup = () => {
          if (touchTimer) {
            clearTimeout(touchTimer);
            touchTimer = null;
          }
          if (!gameOver) setFace('üôÇ');
        };

        btn.addEventListener('touchend', () => {
          if (touchTimer) {
            clearTimeout(touchTimer);
            touchTimer = null;
            if (!moved) {
              if (flagMode) toggleFlag(r, c);
              else reveal(r, c);
            }
          }
          touchCleanup();
        }, { passive: true });

        btn.addEventListener('touchcancel', touchCleanup, { passive: true });

        frag.appendChild(btn);
      }
    }

    elBoard.appendChild(frag);
    updateCellSizing();
    paint();
  }

  function paint() {
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const cell = board[r][c];
        const el = getCellEl(r, c);
        el.classList.toggle('revealed', cell.revealed);
        el.classList.toggle('flag', cell.flagged);
        el.classList.toggle('mine', cell.mine);
        el.classList.remove(...numberClasses);
        el.classList.remove('blast');
        el.textContent = '';
        if (cell.revealed && !cell.mine && cell.adjacent > 0) {
          el.textContent = String(cell.adjacent);
          el.classList.add('n' + cell.adjacent);
        }
      }
    }
  }

  function getCellEl(r, c) {
    return elBoard.querySelector(`[data-r="${r}"][data-c="${c}"]`);
  }

  function initGame() {
    firstClick = true;
    gameOver = false;
    flaggedCount = 0;
    revealedCount = 0;
    totalMines = mineSetting;
    remainingMines = mineSetting;
    updateMineCount();
    resetTimer();
    setFace('üôÇ');
    createEmptyBoard();
    drawBoard();
    updateFlagButtonState();
  }

  function toggleFlag(r, c) {
    if (gameOver) return;
    const cell = board[r][c];
    if (cell.revealed) return;
    cell.flagged = !cell.flagged;
    flaggedCount += cell.flagged ? 1 : -1;
    flaggedCount = clamp(flaggedCount, 0, rows * cols);
    remainingMines = Math.max(0, totalMines - flaggedCount);
    updateMineCount();
    paint();
    checkWin();
  }

  function chord(r, c) {
    if (gameOver) return;
    const cell = board[r][c];
    if (!cell.revealed || cell.adjacent === 0) return;
    let flags = 0;
    const ns = neighbors(r, c);
    for (const [rr, cc] of ns) {
      if (board[rr][cc].flagged) flags++;
    }
    if (flags === cell.adjacent) {
      for (const [rr, cc] of ns) {
        if (!board[rr][cc].flagged && !board[rr][cc].revealed) {
          reveal(rr, cc);
        }
      }
    }
  }

  function reveal(r, c) {
    if (gameOver) return;
    const cell = board[r][c];
    if (cell.revealed || cell.flagged) return;
    if (firstClick) {
      firstClick = false;
      startTimer();
      const exclude = new Set();
      exclude.add(r + ',' + c);
      for (const [rr, cc] of neighbors(r, c)) exclude.add(rr + ',' + cc);
      placeMines(exclude);
    }

    cell.revealed = true;
    revealedCount++;

    if (cell.mine) {
      setFace('üòµ');
      gameOver = true;
      stopTimer();
      for (let rr = 0; rr < rows; rr++) {
        for (let cc = 0; cc < cols; cc++) {
          if (board[rr][cc].mine) board[rr][cc].revealed = true;
        }
      }
      const el = getCellEl(r, c);
      if (el) el.classList.add('blast');
      paint();
      return;
    }

    if (cell.adjacent === 0) {
      const queue = [[r, c]];
      const seen = new Set([r + ',' + c]);
      while (queue.length) {
        const [cr, cc] = queue.shift();
        for (const [rr, rc] of neighbors(cr, cc)) {
          const ncell = board[rr][rc];
          const key = rr + ',' + rc;
          if (ncell.revealed || ncell.flagged || seen.has(key)) continue;
          ncell.revealed = true;
          revealedCount++;
          if (!ncell.mine && ncell.adjacent === 0) queue.push([rr, rc]);
          seen.add(key);
        }
      }
    }

    paint();
    checkWin();
  }

  function checkWin() {
    const total = rows * cols;
    const target = total - totalMines;
    if (!gameOver && revealedCount >= target) {
      gameOver = true;
      stopTimer();
      setFace('üòé');
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = board[r][c];
          if (cell.mine && !cell.flagged) {
            cell.flagged = true;
          }
        }
      }
      flaggedCount = totalMines;
      remainingMines = 0;
      updateMineCount();
      paint();
    }
  }

  elReset.addEventListener('click', () => {
    initGame();
  });

  elFlagMode.addEventListener('click', () => {
    flagMode = !flagMode;
    updateFlagButtonState();
  });

  elDiff.addEventListener('change', () => {
    const value = elDiff.value;
    if (value === 'beginner') {
      setConfig(9, 9, 10);
      elCustomPane.classList.add('hidden');
    } else if (value === 'gevorderd') {
      setConfig(16, 16, 40);
      elCustomPane.classList.add('hidden');
    } else if (value === 'expert') {
      setConfig(16, 30, 99);
      elCustomPane.classList.add('hidden');
    } else {
      elCustomPane.classList.remove('hidden');
      updateCustomInputs();
    }
    savePrefs();
  });

  elApplyCustom.addEventListener('click', () => {
    const r = clamp(parseInt(elRows.value || String(rows), 10), 5, 40);
    const c = clamp(parseInt(elCols.value || String(cols), 10), 5, 40);
    const maxM = maxAllowedMines(r, c);
    const m = clamp(parseInt(elMines.value || String(mineSetting), 10), 1, maxM);
    elDiff.value = 'custom';
    setConfig(r, c, m);
    elCustomPane.classList.remove('hidden');
    savePrefs();
  });

  function updateCustomInputs() {
    elRows.value = String(rows);
    elCols.value = String(cols);
    const max = maxAllowedMines(rows, cols);
    elMines.max = String(max);
    if (mineSetting > max) mineSetting = max;
    elMines.value = String(mineSetting);
  }

  function setConfig(r, c, m) {
    rows = clamp(r, 5, 40);
    cols = clamp(c, 5, 40);
    const max = maxAllowedMines(rows, cols);
    mineSetting = clamp(m, 1, max);
    totalMines = mineSetting;
    remainingMines = mineSetting;
    flaggedCount = 0;
    updateCustomInputs();
    initGame();
  }

  function savePrefs() {
    const data = { diff: elDiff.value, rows, cols, mines: mineSetting };
    try {
      localStorage.setItem('ms_nl_prefs', JSON.stringify(data));
    } catch (err) {
      console.warn('Kon voorkeuren niet opslaan', err);
    }
  }

  function loadPrefs() {
    try {
      const raw = localStorage.getItem('ms_nl_prefs');
      if (!raw) return false;
      const prefs = JSON.parse(raw);
      if (prefs) {
        if (prefs.rows && prefs.cols) {
          rows = clamp(prefs.rows, 5, 40);
          cols = clamp(prefs.cols, 5, 40);
        }
        if (prefs.mines) {
          const max = maxAllowedMines(rows, cols);
          mineSetting = clamp(prefs.mines, 1, max);
        }
        totalMines = mineSetting;
        remainingMines = mineSetting;
        if (prefs.diff) {
          elDiff.value = prefs.diff;
          if (prefs.diff === 'custom') {
            elCustomPane.classList.remove('hidden');
          } else {
            elCustomPane.classList.add('hidden');
          }
        }
      }
      return true;
    } catch (err) {
      console.warn('Kon voorkeuren niet laden', err);
      return false;
    }
  }

  elBoard.addEventListener('contextmenu', (e) => e.preventDefault());

  let resizeTimer = null;
  window.addEventListener('resize', () => {
    syncViewportMetrics();
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      updateCellSizing();
    }, 120);
  });

  if ('ResizeObserver' in window && boardWrap) {
    const boardObserver = new ResizeObserver(() => updateCellSizing());
    boardObserver.observe(boardWrap);
  }

  if (!loadPrefs()) {
    elDiff.value = 'beginner';
    rows = 9;
    cols = 9;
    mineSetting = 10;
    totalMines = 10;
    remainingMines = 10;
  }

  if (elDiff.value === 'custom') {
    elCustomPane.classList.remove('hidden');
  } else {
    elCustomPane.classList.add('hidden');
  }

  updateCustomInputs();
  initGame();
})();
</script>
</body>
</html>
