
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minesweeper</title>

  <script>
    (function() {
      try {
        var pref = localStorage.getItem('theme-preference') || 'system';
        var root = document.documentElement;
        if (pref === 'light') {
          root.setAttribute('data-theme','light');
        } else if (pref === 'dark') {
          root.setAttribute('data-theme','dark');
        } else {
          root.removeAttribute('data-theme');
        }
      } catch(e) { /* noop */ }
    })();
  </script>

  <link rel="stylesheet" href="../styles.css" />

  <style>
    :root{
      --cell-size: 34px;
      --gap: 4px;
      --ms-cell: #d0d6e2;
      --ms-cell-border: #b7bfce;
      --ms-cell-revealed: #f0f3f9;
      --ms-cell-revealed-border: #cdd5e3;
      --ms-cell-shadow: inset 0 2px 0 rgba(255,255,255,.35), inset 0 -2px 0 rgba(0,0,0,.04);
      --ms-mine-bg: #ffd9dd;
      --ms-hover: rgba(63,81,181,0.15);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --ms-cell: #1f2937;
        --ms-cell-border: #111827;
        --ms-cell-revealed: #131c23;
        --ms-cell-revealed-border: #223042;
        --ms-cell-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.6);
        --ms-mine-bg: rgba(248,113,113,0.22);
        --ms-hover: rgba(144,202,249,0.2);
      }
    }

    :root[data-theme="dark"]{
      --ms-cell: #1f2937;
      --ms-cell-border: #111827;
      --ms-cell-revealed: #131c23;
      --ms-cell-revealed-border: #223042;
      --ms-cell-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.6);
      --ms-mine-bg: rgba(248,113,113,0.22);
      --ms-hover: rgba(144,202,249,0.2);
    }

    :root[data-theme="light"]{
      --ms-cell: #d0d6e2;
      --ms-cell-border: #b7bfce;
      --ms-cell-revealed: #f0f3f9;
      --ms-cell-revealed-border: #cdd5e3;
      --ms-cell-shadow: inset 0 2px 0 rgba(255,255,255,.35), inset 0 -2px 0 rgba(0,0,0,.04);
      --ms-mine-bg: #ffd9dd;
      --ms-hover: rgba(63,81,181,0.15);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-gradient);
      color: var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    main{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(100%, 900px);
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .app-header{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      padding: 8px 8px 4px;
    }
    .left, .right{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .stat{
      background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:8px 10px; min-width:90px;
      display:flex; align-items:center; gap:8px; box-shadow: var(--shadow);
    }
    .stat b{font-variant-numeric: tabular-nums}
    select, input[type=number]{
      border:1px solid var(--border); border-radius:8px; padding:8px 10px; background:var(--panel); color:var(--text);
    }
    button{
      border:1px solid var(--border); background:var(--panel); color:var(--text); border-radius:10px; padding:8px 12px; cursor:pointer; box-shadow: var(--shadow);
    }
    button:hover{filter:brightness(0.98)}
    button:active{transform: translateY(1px)}

    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .group{display:flex; gap:6px; align-items:center}
    .hidden{display:none}

    .board-wrap{
      margin-top:12px; padding:10px; border:1px solid var(--border); border-radius:14px; background:var(--panel); box-shadow: var(--shadow);
    }
    #board{
      display:grid; grid-template-columns: repeat(10, var(--cell-size));
      gap: var(--gap);
      justify-content:center;
      touch-action: manipulation;
      user-select: none;
    }
    .cell{
      width:var(--cell-size); height:var(--cell-size); border-radius:8px; background:var(--ms-cell); border:1px solid var(--ms-cell-border);
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; color:var(--text);
      box-shadow: var(--ms-cell-shadow);
      position:relative;
    }
    .cell:hover{filter:brightness(1.02)}
    .cell.revealed{
      background:var(--ms-cell-revealed); border-color:var(--ms-cell-revealed-border); box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
    }
    .cell.mine.revealed{ background:var(--ms-mine-bg); }
    .cell.blast{ animation: blip .18s ease-out 2 alternate; }
    @keyframes blip{from{transform:scale(1)} to{transform:scale(1.08)}}

    .cell.flag::after{ content:"üö©"; }
    .cell.mine.revealed::after{ content:"üí£"; }

    /* Kleuren voor cijfers 1-8 */
    .n1{ color:#1976d2 }
    .n2{ color:#388e3c }
    .n3{ color:#d32f2f }
    .n4{ color:#7b1fa2 }
    .n5{ color:#bf360c }
    .n6{ color:#00838f }
    .n7{ color:#424242 }
    .n8{ color:#222 }

    .footer{ margin-top:10px; text-align:center; color:var(--muted); font-size:12px }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand" aria-label="Rvds" title="Rvds">Rvds</div>
    <nav class="site-nav">
      <a href="../index.html#apps">Apps</a>

      <div class="theme-switch" role="group" aria-label="Thema">
        <button class="theme-btn" data-theme="system" title="Systeem" aria-pressed="true">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v9H3V5Zm-2 11h22v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1Z"/></svg>
          <span class="visually-hidden">Systeem</span>
        </button>
        <button class="theme-btn" data-theme="light" title="Licht" aria-pressed="false">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M12 4a1 1 0 0 0 1-1V1h-2v2a1 1 0 0 0 1 1Zm0 16a1 1 0 0 0-1 1v2h2v-2a1 1 0 0 0-1-1ZM4 11H1v2h3v-2Zm22 0h-3v2h3v-2ZM5.64 6.05 3.52 3.93l-1.41 1.41 2.12 2.12 1.41-1.41Zm15.25 15.25-2.12-2.12-1.41 1.41 2.12 2.12 1.41-1.41ZM18.36 6.05l1.41-1.41L17.66 2.1l-1.41 1.41 2.11 2.54Zm-12.02 12.9-1.41 1.41 2.12 2.12 1.41-1.41-2.12-2.12ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z"/></svg>
          <span class="visually-hidden">Licht</span>
        </button>
        <button class="theme-btn" data-theme="dark" title="Donker" aria-pressed="false">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/></svg>
          <span class="visually-hidden">Donker</span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <div class="app" role="application" aria-label="Minesweeper">
      <div class="app-header">
        <div class="left">
          <div class="stat" aria-live="polite" title="Aantal niet-geflagde mijnen">
            ‚õ≥ <span>Mijnen:</span> <b id="mineCount">0</b>
          </div>
          <div class="stat" aria-live="polite" title="Verstreken tijd in seconden">
            ‚è±Ô∏è <span>Tijd:</span> <b id="timer">0</b>s
          </div>
          <button id="resetBtn" title="Nieuw spel">üôÇ</button>
        </div>
        <div class="right">
          <div class="toolbar">
            <div class="group">
              <label for="difficulty">Moeilijkheid:</label>
              <select id="difficulty">
                <option value="beginner">Beginner (9√ó9, 10)</option>
                <option value="gevorderd">Gevorderd (16√ó16, 40)</option>
                <option value="expert">Expert (16√ó30, 99)</option>
                <option value="custom">Aangepast</option>
              </select>
            </div>
            <div id="customPane" class="group hidden">
              <label>Rijen <input id="rows" type="number" min="5" max="40" value="16" /></label>
              <label>Kolommen <input id="cols" type="number" min="5" max="40" value="16" /></label>
              <label>Mijnen <input id="mines" type="number" min="1" value="40" /></label>
              <button id="applyCustom">Toepassen</button>
            </div>
            <button id="flagModeBtn" title="Schakel vlag-modus (voor mobiel)">üö© Vlag-modus: UIT</button>
          </div>
        </div>
      </div>

      <div class="board-wrap">
        <div id="board"></div>
      </div>

      <div class="footer">Tip: Klik met rechts om te vlaggen. Op mobiel: lang indrukken of gebruik de knop <em>Vlag-modus</em>.</div>
    </div>
  </main>

  <footer class="site-footer">
    <span>¬© 2025 Rvds</span>
  </footer>

  <script src="../assets/js/theme.js" defer></script>

<script>
// --- Minesweeper (Nederlands) -------------------------------------------------
// Functies en UI in √©√©n HTML-bestand, geen afhankelijkheden.

(function(){
  // Spelstatus
  let rows = 9, cols = 9, mines = 10;
  let firstClick = true;
  let board = []; // 2D array met cellen: {mine, revealed, flagged, adjacent}
  let remainingMines = mines;
  let revealedCount = 0;
  let timerId = null; let seconds = 0;
  let gameOver = false;
  let flagMode = false; // voor mobiel

  // Elementen
  const elBoard = document.getElementById('board');
  const elMineCount = document.getElementById('mineCount');
  const elTimer = document.getElementById('timer');
  const elReset = document.getElementById('resetBtn');
  const elDiff = document.getElementById('difficulty');
  const elCustomPane = document.getElementById('customPane');
  const elRows = document.getElementById('rows');
  const elCols = document.getElementById('cols');
  const elMines = document.getElementById('mines');
  const elApplyCustom = document.getElementById('applyCustom');
  const elFlagMode = document.getElementById('flagModeBtn');

  // Hulpfuncties
  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
  function idxIn(r,c){ return r>=0 && r<rows && c>=0 && c<cols; }
  function neighbors(r,c){
    const ns=[];
    for(let dr=-1; dr<=1; dr++) for(let dc=-1; dc<=1; dc++){
      if(dr===0 && dc===0) continue; const rr=r+dr, cc=c+dc; if(idxIn(rr,cc)) ns.push([rr,cc]);
    }
    return ns;
  }

  function stopTimer(){ if(timerId){ clearInterval(timerId); timerId=null; } }
  function startTimer(){ if(!timerId){ timerId = setInterval(()=>{ seconds++; elTimer.textContent = String(seconds); },1000);} }
  function resetTimer(){ stopTimer(); seconds=0; elTimer.textContent='0'; }

  function updateMineCount(){ elMineCount.textContent = String(remainingMines); }
  function setFace(face){ elReset.textContent = face; }

  // Bord opbouwen
  function createEmptyBoard(){
    board = Array.from({length: rows}, ()=> Array.from({length: cols}, ()=>({
      mine:false, revealed:false, flagged:false, adjacent:0
    })));
  }

  function placeMines(excludeSet){
    // excludeSet: Set met sleutel "r,c" die geen mijn mogen bevatten (bv. eerste klik + buren)
    const cells=[]; for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      const key=r+","+c; if(!excludeSet.has(key)) cells.push([r,c]);
    }
    const maxMines = cells.length; // maximaal toegestaan na uitsluiting
    let m = Math.min(mines, maxMines);
    shuffle(cells);
    for(let i=0;i<m;i++){
      const [r,c] = cells[i]; board[r][c].mine = true;
    }
    // Adjacenten berekenen
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      if(board[r][c].mine){ board[r][c].adjacent=0; continue; }
      let count=0; for(const [rr,cc] of neighbors(r,c)) if(board[rr][cc].mine) count++;
      board[r][c].adjacent = count;
    }
  }

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()* (i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } }

  function drawBoard(){
    elBoard.style.gridTemplateColumns = 'repeat(' + cols + ', var(--cell-size))';
    elBoard.innerHTML='';
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const div=document.createElement('button');
        div.className='cell';
        div.setAttribute('data-r', String(r));
        div.setAttribute('data-c', String(c));
        div.setAttribute('aria-label', 'Vakje '+(r+1)+','+(c+1));
        div.oncontextmenu = (e)=>{ e.preventDefault(); toggleFlag(r,c); };
        div.addEventListener('mousedown', ()=>{ if(!gameOver) setFace('üòÆ'); });
        div.addEventListener('mouseup', ()=>{ if(!gameOver) setFace('üôÇ'); });

        // Muisklikken
        div.addEventListener('click', (e)=>{
          e.preventDefault();
          if(flagMode) { toggleFlag(r,c); return; }
          reveal(r,c);
        });
        div.addEventListener('auxclick', (e)=>{ // middelklik voor chord
          if(e.button===1){ chord(r,c); }
        });

        // Touch/long-press voor vlag
        let touchTimer=null; let moved=false;
        div.addEventListener('touchstart', (e)=>{
          moved=false; setFace('üòÆ');
          touchTimer = setTimeout(()=>{ toggleFlag(r,c); touchTimer=null; }, 450);
        }, {passive:true});
        div.addEventListener('touchmove', ()=>{ moved=true; });
        div.addEventListener('touchend', (e)=>{
          setFace('üôÇ');
          if(touchTimer){ clearTimeout(touchTimer); touchTimer=null; if(!moved){ if(flagMode){ toggleFlag(r,c); } else { reveal(r,c); } } }
        });

        elBoard.appendChild(div);
      }
    }
    paint();
  }

  function paint(){
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = board[r][c];
        const el = getCellEl(r,c);
        el.classList.toggle('revealed', cell.revealed);
        el.classList.toggle('flag', cell.flagged);
        el.classList.toggle('mine', cell.mine);
        el.textContent='';
        if(cell.revealed){
          if(!cell.mine && cell.adjacent>0){
            el.textContent = String(cell.adjacent);
            el.classList.remove('n1','n2','n3','n4','n5','n6','n7','n8');
            el.classList.add('n'+cell.adjacent);
          }
          if(cell.mine){ el.textContent=''; }
        }
      }
    }
  }

  function getCellEl(r,c){ return elBoard.querySelector('[data-r="'+r+'"][data-c="'+c+'"]'); }

  function initGame(){
    firstClick = true; gameOver=false; revealedCount=0; remainingMines=mines; updateMineCount(); resetTimer(); setFace('üôÇ');
    createEmptyBoard();
    drawBoard();
  }

  // Acties
  function toggleFlag(r,c){ if(gameOver) return; const cell=board[r][c]; if(cell.revealed) return; 
    cell.flagged = !cell.flagged; remainingMines += (cell.flagged? -1: +1); updateMineCount(); paint(); checkWin(); }

  function chord(r,c){
    // Als nummer is onthuld en aantal vlaggen rondom = nummer, onthul overige buren
    const cell=board[r][c]; if(!cell.revealed || cell.adjacent===0) return;
    let flags=0; const ns = neighbors(r,c);
    for(const [rr,cc] of ns) if(board[rr][cc].flagged) flags++;
    if(flags === cell.adjacent){
      for(const [rr,cc] of ns){ if(!board[rr][cc].flagged && !board[rr][cc].revealed){ reveal(rr,cc); } }
    }
  }

  function reveal(r,c){
    if(gameOver) return; const cell=board[r][c]; if(cell.revealed || cell.flagged) return;
    if(firstClick){
      // Plaats mijnen na de eerste klik, zodat eerste vakje en buren altijd veilig zijn
      firstClick=false; startTimer();
      const exclude = new Set(); exclude.add(r+","+c); for(const [rr,cc] of neighbors(r,c)) exclude.add(rr+","+cc);
      placeMines(exclude);
      // Als eerste klik toevallig naast veel getallen is, prima. (We garanderen alleen veiligheid)
    }

    cell.revealed=true; revealedCount++;

    if(cell.mine){
      // Game over
      setFace('üòµ'); gameOver=true; stopTimer();
      // Toon alle mijnen
      for(let rr=0; rr<rows; rr++) for(let cc=0; cc<cols; cc++){
        if(board[rr][cc].mine){ board[rr][cc].revealed=true; }
      }
      const el = getCellEl(r,c); el.classList.add('blast');
      paint();
      return;
    }

    // Flood fill bij 0
    if(cell.adjacent===0){
      const q=[[r,c]]; const seen=new Set([r+","+c]);
      while(q.length){
        const [cr,cc]=q.shift();
        for(const [rr,rc] of neighbors(cr,cc)){
          const ncell = board[rr][rc];
          const key=rr+","+rc;
          if(ncell.revealed || ncell.flagged || seen.has(key)) continue;
          ncell.revealed=true; revealedCount++;
          if(!ncell.mine && ncell.adjacent===0){ q.push([rr,rc]); }
          seen.add(key);
        }
      }
    }

    paint();
    checkWin();
  }

  function checkWin(){
    // Gewonnen als alle niet-mijn vakjes zijn onthuld
    const total = rows*cols; const target = total - mines;
    if(!gameOver && revealedCount >= target){
      gameOver=true; stopTimer(); setFace('üòé');
      // Zet vlag op alle nog niet gevlagde mijnen
      for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
        const cell=board[r][c]; if(cell.mine && !cell.flagged){ cell.flagged=true; remainingMines--; }
      }
      updateMineCount(); paint();
    }
  }

  // UI events
  elReset.addEventListener('click', ()=>{ initGame(); });
  elFlagMode.addEventListener('click', ()=>{
    flagMode = !flagMode; elFlagMode.textContent = (flagMode? 'üö© Vlag-modus: AAN' : 'üö© Vlag-modus: UIT');
  });

  elDiff.addEventListener('change', ()=>{
    const v = elDiff.value;
    if(v==='beginner'){ setConfig(9,9,10); elCustomPane.classList.add('hidden'); }
    else if(v==='gevorderd'){ setConfig(16,16,40); elCustomPane.classList.add('hidden'); }
    else if(v==='expert'){ setConfig(16,30,99); elCustomPane.classList.add('hidden'); }
    else { // custom
      elCustomPane.classList.remove('hidden');
      // stel velden in op huidige waarden
      elRows.value = String(rows); elCols.value = String(cols); elMines.value = String(mines);
    }
    savePrefs();
  });

  elApplyCustom.addEventListener('click', ()=>{
    let r = clamp(parseInt(elRows.value||'16',10), 5, 40);
    let c = clamp(parseInt(elCols.value||'16',10), 5, 40);
    let maxM = r*c - 1; // minimaal 1 vrij vakje; bij eerste klik sluiten we 1+8 uit, maar dat corrigeren we bij plaatsing
    let m = clamp(parseInt(elMines.value||'40',10), 1, maxM);
    setConfig(r,c,m); savePrefs();
  });

  function setConfig(r,c,m){ rows=r; cols=c; mines=m; remainingMines=m; initGame(); }

  // Opslaan/Herstellen voorkeuren
  function savePrefs(){
    const data = { diff: elDiff.value, rows, cols, mines };
    try{ localStorage.setItem('ms_nl_prefs', JSON.stringify(data)); }catch(e){}
  }
  function loadPrefs(){
    try{
      const raw = localStorage.getItem('ms_nl_prefs');
      if(!raw) return false;
      const p = JSON.parse(raw);
      if(p && p.rows && p.cols && p.mines){ rows=p.rows; cols=p.cols; mines=p.mines; }
      // Stel difficulty select in
      if(p && p.diff){ elDiff.value=p.diff; if(p.diff==='custom') elCustomPane.classList.remove('hidden'); }
      return true;
    }catch(e){ return false; }
  }

  // Blokkeer contextmenu op het bord (we gebruiken rechtsklik voor vlaggen)
  elBoard.addEventListener('contextmenu', (e)=> e.preventDefault());

  // Start
  if(!loadPrefs()){
    elDiff.value = 'beginner'; rows=9; cols=9; mines=10;
  }
  // Zorg dat het custom-pane de juiste zichtbaarheid heeft
  if(elDiff.value==='custom') elCustomPane.classList.remove('hidden'); else elCustomPane.classList.add('hidden');
  initGame();
})();
</script>
</body>
</html>
